# 应用高可用（High Availability） {#high-availability}

i2高可用提供应用高可用。应用高可用主要是针对各种应用提供高可用服务，监控时可以提供多条高可用规则保护，监控对象可以是主节点、从节点或者同时监控，引入了仲裁机制，避免主、从节点由于网络等原因导致错误切换等，同时将数据同步加入了高可用中，实现数据同步关联高可用，比如主节点和从节点都安装好了SQL Server 2005， 利用i2应用高可用功能实现对SQL Server 2005的高可用。当主节点监控的服务，或者进程等出现故障，主节点将成为从节点，原主节点到原从节点的关联复制规则停止，从节点升级为主节点，新主节点到新从节点的关联复制规则开启。

i2软件提供应用高可用功能，其拓扑结构如下：

![](/assets/V6.028142.png)

当主机正常工作，监控对象也没有异常表现时，由主节点对外提供服务（比如SQL Server），通过关联规则将变化的数据实时复制到从节点，高可用规则配置的监控对象保持实时监控的状态。当监控对象出现异常状态时，执行资源切换脚本，i2软件自动关闭主节点的服务（比如SQL Server），关联规则被停止，主节点切换成从节点；虚IP地址迁移到从节点，从节点启动服务，开启关联规则，此时从节点跳转为主节点，继续对外提供服务。

i2软件当主节点发生故障而进行切换时，主、从节点执行的切换过程如下：

![](/assets/V7.1.2019011414.png)

需要特别注意的是：

在没有配置仲裁的情况下，如果主节点和从节点之间的网络出现故障，其他网络正常时，可能在控制机界面上看到两个主节点，导致ip冲突等现象，属正常现象，避免这个现象方式是为规则设置仲裁；

i2高可用提供集群服务器池。服务器池由高可用集群(多台机器堆叠成高可用)和多台服务器组成，高可用集群上跑服务器池中心管理模块(server端)，服务器上跑服务器池管理模块(client端)。中心节点的高可用服务器由多台服务器组成,结构图如下:

![](/assets/20190410110137.png)

中心节点的高可用服务器集群工作原理同高可用性应用相同，最上层跑的是服务器池中心管理软件的应用。当某台服务出现问题时，能够快速的从服务器中加入新的服务器恢复高可用性应用。
服务器中的所有服务器都会运行服务器管理软件模块(client端)，包括组成中心节点的高可用服务器集群的这几台服务器。服务器管理软件模块(client端)负责通过中心节点虚IP与中心节点通讯，汇总和更新集群信息。每个服务器上还可以预先设置好标签，可以支持哪些服务，以提供分配是决策使用。

服务器的配置由用户配置好从配置中心服务器下发的，此时还没有中心节点高可用服务器集群。中心节点高可用服务器集群的建立过程是，服务器找不到中心节点，都会向配置中心服务器汇报，超过一半数量时，中心服务发现确实找不到中心节点，就会自动分配若干台服务器，通过高可用的配置信息，建立高可用性集群。当高可用性集群同时宕机时，也是通过上述机制恢复的。若高可用性集群正常工作时，所有的服务器成员不于配置服务器保持联系。
中心节点的高可用服务器集群对内负责汇总收集服务器信息，对外提供服务器申请服务。

 * [添加应用高可用规则](new_ha_rep.md)
 * [应用高可用规则列表](ha_management.md)
 * [集群服务器池](ha_cls_pool.md)
 * [标签](ha_service_label.md)




