## 添加应用高可用规则

在控制机管理界面，通过 高可用管理-&gt;应用高可用，来添加/编辑 应用高可用规则，应用高可用规则添加/编辑页面如下：

*   规则名称”：客户命名的名称，便于管理；
*   “节点设置”：节点之间不能是同一台机器，可添加多个节点进入HA群，当定义优先级相同的时候设置的初始主节点才有意义，否则优先级高的会成为初始主节点
*   “心跳线”：HA节点间的通讯模块，负责HA节点间的信息通讯，心跳的检测，HA节点之间可以定义多条UDP、TCP、ping类型心跳线，心跳使用的端口，网卡，ip地址可自定义；
*   “数据同步”：设置HA规则关联的数据同步选项，在复制管理中可以看到设置的复制规则，也可以在复制管理中修改停止的复制规则，只能开启从主节点到从节点的复制规则，HA的规则状态会导致相应的关联规则的变化。数据同步中勾选“等缓存清空后切换”时，在达到切换条件时，会优先将复制规则缓冲的数据传输完成时才会切换；创建反向规则即为从主节点到从节点创建一条规则的同时，从节点到主节点也创建一条一样的复制规则；

注意：若选中“反向规则”，请确保规则中源和目标均为目录。

*   “监控对象”：资源监控分为主节点资源监控和从节点资源监控，监控角色选择从节点时，只能做警告处理，不会引起切换，监控对象可以选择服务、进程、内存、cpu、自定义脚本、磁盘监控的方式。选择进程监控时，可以选择填写进程的名称或者进程号。勾选失败后仅做警告时，如果监控对象出现异常，会在日志中产生警告信息，不会导致切换。可以创建多条监控对象，各个监控对象是独立的，任何一条达到切换要求，都会引起切换；

**注意：**

自定义脚本监控时，添加的脚本文件会定时执行一次，注意这个脚本执行的时间一定不能大于“间隔时间”* ”最大失败次数“，并且脚本必需有返回

自定义脚本监控，监控结果输出文件，这个文件中如果写入的是false，则会引起切换或者警告，注意false必须为文本的头5个字符，文件中写入的为true或者其他时规则不会有任何改变

脚本必须存放在主从节点指定的路径下，Windows上，脚本的根目录为：

&lt;i2Soft installation Path&gt;\scripts

Linux上，脚本的根目录为：/etc/sdata/scripts

可以在脚本根目录下，创建子目录。Windows脚本必须是以.bat或者.cmd为后缀的批处理文件；Linux脚本必须是可执行文件（必须有可执行属性）。

磁盘监控如果为windows时，在盘符选择时要添加“：“如监控C盘时，在盘符选择时添加C：

如果为linux时，则添加的目录为此目录所在的卷组或者分区的空间大小

*   “资源切换”：资源切换分为脚本切换资源和虚ip，资源切换脚本中当主节点资源监控非正常情况下，主节点和从节点协商中发现需要切换，主节点切换成从节点时需要释放所占有的资源会执行“释放资源执行的脚本”，从而自身将为从节点，从节点切换成主节点时需要获取资源执行“获取资源执行的脚本”，从而自身升为主节点。虚ip设置时，设置虚ip的地址，这个地址会随主节点的切换而漂移，选择的网卡即是这个虚ip所附属的网卡

**注意：**

脚本在主节点和从节点上必须是同时存在的，并且放在指定的目录下，Windows上，脚本的根目录为：

&lt;i2Soft installation Path&gt;\scripts

Linux上，脚本的根目录为：/etc/sdata/scripts

可以在脚本根目录下，创建子目录。Windows脚本必须是以.bat或者.cmd为后缀的批处理文件；Linux脚本必须是可执行文件（必须有可执行属性）。

虚ip配置如下：

*   仲裁设置：当前只支持节点仲裁

使用节点仲裁时需要设置一个仲裁ip地址，这个仲裁ip所在的主机需要安装i2节点软件，并且i2Availability进程正常运行，在心跳线全部失效的情况下，要用到仲裁机制来判断谁能接管资源