## 复制规则高级属性

### 镜像设置 {#-0}

![](/assets/V7.018042614.png)

* “校验方式“：在重镜像（Remirror）过程中有两种校验算法可以选择：时间校验和严格校验。

  * 时间校验:按照文件的大小以及修改时间来判断文件是否被修改过。
  * 严格校验:需读取文件的内容做校验。显然时间校验模式速度比严格校验快很多，适合镜像时，工作机端确保无修改操作； 或网络带宽较小且要同步的数据非常大等情形。 对于数据库文件等频繁修改的文件，应该选择 “严格校验”；

* “错误处理方式“：如果源路径包含系统目录和文件，灾备软件可能无法访问某些特定的系统文件。对于这种情况，软件给出两种解决办法，如下：

  * 在遇到无法访问的文件时，立刻停止镜像；

  * 在遇到无法访问的文件时，记录无法访问的文件后，继续镜像；

* “文件打开方式“：指在镜像阶段，源端打开文件的方式，该选项只针对Windows工作机有效。在复制阶段，I2是不会读取文件内容的。

  * “普通文件”：指I2灾备软件以普通文件的方式打开需要镜像的文件，该种方式效率较高；

  * “MFT”：指I2灾备软件以MFT（Windows OS提供）的方式打开需要镜像的文件，该种方式可以打开已经被其他进程以独占方式打开的文件，比如数据库文件等，该种方式镜像效率相比普通文件方式较差。

  * “自动选择”：I2灾备软件根据实际情况自动选择打开文件的方式。

* “文件安全属性”：设置源端的用户权限等安全属性是否同步到备端。

如果开启了系统参数中的特殊参数，会在此配置界面多出一个，跳过镜像的配置项

![](/assets/V7.118042615.png)

* 跳过镜像

  1. “正常镜像”：此方式和普通配置无任何区别
  2. “直接进入复制状态”：配置此选项会跳过镜像状态，直接进入复制状态
  3. “仅同步目录”：镜像过程中只同步目录，不同步文件

**注意事项：**

```
此选项为特殊用户的的特殊需求，配置前请联系售后工程师，以防数据出现丢失情况。
```

### 压缩加密 {#-1}

在数据灾备的过程中，可以定义数据是否要加密，由用户自定义加密的密钥。压缩则可选择2种不同的压缩等级，随着压缩等级的提升，消耗的资源也会相应增加。

![](/assets/V7.018042613.png)

### 快照设置 {#-2}

针对复制规则，用户可自动或者手工生成快照。快照即当前数据的一个“切片”。快照手工生成在复制规则的管理页面中通过手工操作实现。定义快照自动生成的时候，必须定义快照的生成间隔时间、开始时间，以及快照数目参数。当快照达到上限个数是，采用的规则有两种：自动循环或者自动终止。一个快照占用的磁盘空间和当前的数据占用的磁盘空间一样，所以当定义自动快照的时候，要注意有足够的磁盘空间放置相应的快照，不需要的快照通过快照管理及时删除。

![](/assets/V7.018042609.png)

### CDP设置 {#cdp}

CDP（Continuous Data Protection，CDP），即持续数据保护。持续数据保护可以捕获或跟踪数据的变化，并将其独立存放在生产数据之外，以确保数据可以恢复到过去的任意时间点。持续数据保护可以为恢复对象提供足够细的恢复粒度，实现任意的恢复时间点。由于CDP记录所有的修改操作以及数据的变化，所以占用的磁盘空间是比较大。I2灾备软件独特的多Baseline支持可以提高配置的灵活性，以及CDP恢复的速度。

通过如下页面设置CDP数据的保存策略：

###### 不开启使用快照做baseline

![](/assets/V7.1.2019011021.png)

* “处理时间”：当连续的CDP数据超过指定的天数后，需要按天合并；如果指定了baseline的生产策略，需要按配置生成Baseline，“处理时间”就是指CDP后台开始生成这些数据的开始时间。通常，选择业务较为空闲的时间为宜，且生成baseline的过程中，数据会堵在源端，在未生成完时，数据不会同步。

* “数据目录”：备机在指定目录下生成一个以复制规则的uuid为名称的文件夹，存放该复制规则产生的CDP（连续数据保护）数据。要注意的是，因为CDP数据要占用较大的磁盘空间，所以如果用户设置了规则中的CDP属性，则要充分保证该目录的磁盘空间大小。

* “保留天数”：连续CDP保留天数，设置此项在此时间段内可以恢复到任意有数据变化的时间点。

* “保留个数”：把连续的CDP数据按天合并以减少磁盘占用，在此时间段内，数据可以恢复到这一天的结束的时间点；

###### 开启使用快照做baseline

![](/assets/V7.1.2019011020.png)

* “使用快照做baseline” ：开始使用快照做baseline

* “细粒度快照的时间间隔”：此时间间隔为多久生成一个快照baseline

* “细粒度快照的保存个数”：以快照形式保存的baseline的个数

* “按天生成的快照的保存个数”：每天会生成一个快照类型的baseline，此baseline保留的个数。

**baseline设置**

* Baseline存储格式：

  * “保持源目录结构”是按Baseline生成时的源端目录结构来存储Baseline；
  * “打包”是将大量小文件打包，目的是缩短恢复时间。

* 创建副本：创建一个Baseline副本目的也是缩短恢复时间。

* 生成策略：用户可以指定每周/每月/每年的baseline生成策略。

**注意事项：**

```
1、创建复制规则时开启了CDP，如果后续修改备份目录时，CDP会重新生成一个新的baseline，原CDP继续保留，CDP恢复时，可以选择不同时间点恢复到不同的时刻，选择不同的时间点，目录结构不同
2、关闭CDP选项时，已经生成的baseline会被删除
3、HA关联规则，如果HA切换时，会导致关联规则的baseline重新生成
```

### 孤儿文件 {#-3}

当在某些情况下，某些文件在灾备机端存在，在工作机端不存在时，这些文件被称为孤儿文件。一种可能是灾备机和工作机端的连接由于网络故障或者用户关闭工作机而中断了，在中断的过程中，客户删除了工作机上的某些文件，但这些删除操作导致了灾备通道的中断而没有将相关数据同步到灾备机上，下次恢复灾备的时候，就会发现这些文件只存在于灾备机上。i2灾备软件针对该类型的文件有三种处理方式：

![](/assets/V7.018042608.png)

* “不处理”: 即继续保存在灾备机上；
* “删除”: 从灾备机上删除掉这些孤儿文件；
* “移动到指定路径”: 即将所有的孤儿文件移动到某个特定的目录下统一管理。
* “移动到指定目录并归档”: 当复制规则处于“复制”状态时，源目录下的某个文件和目录被删除时，目标目录下文件和目录移到指定路径下，实现数据的归档。

### 带宽控制 {#-4}

当在某些情况下，用户想限定带宽的使用，可以通过带宽控制来实现。比如，通过Internet实现数据异地灾备，但同时用户又不想在上班时间影响员工的Internet访问速度，就可以限定工作机时间的带宽。

![](/assets/V7.018042610.png)

### 比较计划 {#-7}

打开“开启比较计划”，规则会在指定下面添加的时间点进行比较；具体描述如下：

![](/assets/V7.201811141021.png)

### 高级设置 {#-6}

![](/assets/4902840938490374983749837487.png)

* “文件名转换”：软件可以通过文件名转换的方式，在备份到备端后，修改文件名，在其文件头、后缀尾，添加前缀或者后缀，或者修改文件名称中的大小写
  * 增加前缀：即在文件前添加字符串，（比如文件名为test.txt，前缀设置为 prefix ,则备份后文件为 prefixtest.txt）
  * 增加后缀：即在文件后缀后添加字符串，（比如文件名为test.txt，后缀设置为 Suffix ,则备份后文件为test.txtSuffix）
  * 大小写：将文件名转换成设置的对应的格式。转大写、转小写或者保持不变

**注意事项**
`设置大小写时，必须先设置前缀后缀，大小写设置不能单独使用`

* 并行任务数：设置并行任务数，设置软件并发连接数，对于海量小文件、单连接达到最大带宽时，可以大大提升备份速度

* “删除策略“：默认不选中，其意思是在删除该规则时，保留灾备机上由“目标路径”配置项所指定的目录下的所有数据；如果选中，其意思是删除该规则时，清空灾备机上由“目标路径”配置项所指定的目录下的所有数据；

勾选“启用禁止镜像功能，禁止镜像时间窗口”，禁止镜像功能在指定的时间范围内，禁止镜像；具体描述如下：

```
（1）在该时间范围内，如果规则需要重镜像，则停止镜像；
（2）在该时间范围内，如果规则正在镜像，则停止镜像；
（3）在该时间范围内，如果规则状态为非镜像状态，保持不变；
```

### 删除复制规则 {#-5}

通过勾选其中一条或多条复制规则，点击删除按钮；或者点击其中一条复制规则的操作栏内的删除图标，删除成功后两端不再同步；

![](/assets/V7.025074.png)

需要注意的是，删除某条复制规则后，灾备端与该复制规则相应的复制数据、CDP数据以及快照数据删除与否，有配置规则的“删除策略”选项决定。

### 批量修改 {#-6}

软件提供规则批量修改的功能，通过批量修改功能，能将处于停止状态的规则批量修改为自己想要配置的项，点击批量修改按钮，具体配置如下：

![](/assets/V7.1.2019011402.png)

开启批量修改，选择需要修改的项，点击选定规则，如下图

![](/assets/V7.1.2019011403.png)

选择需要修改的规则，提交

![](/assets/V7.1.2019011404.png)

